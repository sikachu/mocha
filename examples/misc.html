<html><head><link rel="stylesheet" media="screen" href="coderay.css" type="text/css"></head><body><div class="CodeRay">
  <div class="code"><pre>require <span class="s"><span class="dl">'</span><span class="k">test/unit</span><span class="dl">'</span></span>
require <span class="s"><span class="dl">'</span><span class="k">mocha</span><span class="dl">'</span></span>

<span class="r">class</span> <span class="cl">MiscExampleTest</span> &lt; <span class="co">Test</span>::<span class="co">Unit</span>::<span class="co">TestCase</span>
  
  <span class="r">def</span> <span class="fu">test_mocking_a_class_method</span>
    product = <span class="co">Product</span>.new
    <span class="co">Product</span>.expects(<span class="sy">:find</span>).with(<span class="i">1</span>).returns(product)
    assert_equal product, <span class="co">Product</span>.find(<span class="i">1</span>)
  <span class="r">end</span>

  <span class="r">def</span> <span class="fu">test_mocking_an_instance_method_on_a_real_object</span>
    product = <span class="co">Product</span>.new
    product.expects(<span class="sy">:save</span>).returns(<span class="pc">true</span>)
    assert product.save
  <span class="r">end</span>

  <span class="r">def</span> <span class="fu">test_stubbing_instance_methods_on_real_objects</span>
    prices = [stub(<span class="sy">:pence</span> =&gt; <span class="i">1000</span>), stub(<span class="sy">:pence</span> =&gt; <span class="i">2000</span>)]
    product = <span class="co">Product</span>.new
    product.stubs(<span class="sy">:prices</span>).returns(prices)
    assert_equal [<span class="i">1000</span>, <span class="i">2000</span>], product.prices.collect {|p| p.pence}
  <span class="r">end</span>

  <span class="r">def</span> <span class="fu">test_stubbing_an_instance_method_on_all_instances_of_a_class</span>
    <span class="co">Product</span>.any_instance.stubs(<span class="sy">:name</span>).returns(<span class="s"><span class="dl">'</span><span class="k">stubbed_name</span><span class="dl">'</span></span>)
    product = <span class="co">Product</span>.new
    assert_equal <span class="s"><span class="dl">'</span><span class="k">stubbed_name</span><span class="dl">'</span></span>, product.name
  <span class="r">end</span>

  <span class="r">def</span> <span class="fu">test_traditional_mocking</span>
    object = mock()
    object.expects(<span class="sy">:expected_method</span>).with(<span class="sy">:p1</span>, <span class="sy">:p2</span>).returns(<span class="sy">:result</span>)
    assert_equal <span class="sy">:result</span>, object.expected_method(<span class="sy">:p1</span>, <span class="sy">:p2</span>)
  <span class="r">end</span>

  <span class="r">def</span> <span class="fu">test_shortcuts</span>
    object = stub(<span class="sy">:method1</span> =&gt; <span class="sy">:result1</span>, <span class="sy">:method2</span> =&gt; <span class="sy">:result2</span>)
    assert_equal <span class="sy">:result1</span>, object.method1
    assert_equal <span class="sy">:result2</span>, object.method2
  <span class="r">end</span>
  
<span class="r">end</span></pre></div>
</div>
</body></html>